---
title: 385-迷你语法分析器(Mini Parser)
date: 2021-12-03 22:48:51
categories:
  - 中等
tags:
  - 栈
  - 深度优先搜索
  - 字符串
---

> 原文链接: https://leetcode-cn.com/problems/mini-parser


## 英文原文
<div><p>Given a string s represents the serialization of a nested list, implement a parser to deserialize it and return <em>the deserialized</em> <code>NestedInteger</code>.</p>

<p>Each element is either an integer or a list whose elements may also be integers or other lists.</p>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>

<pre>
<strong>Input:</strong> s = &quot;324&quot;
<strong>Output:</strong> 324
<strong>Explanation:</strong> You should return a NestedInteger object which contains a single integer 324.
</pre>

<p><strong>Example 2:</strong></p>

<pre>
<strong>Input:</strong> s = &quot;[123,[456,[789]]]&quot;
<strong>Output:</strong> [123,[456,[789]]]
<strong>Explanation:</strong> Return a NestedInteger object containing a nested list with 2 elements:
1. An integer containing value 123.
2. A nested list containing two elements:
    i.  An integer containing value 456.
    ii. A nested list with one element:
         a. An integer containing value 789
</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>1 &lt;= s.length &lt;= 5 * 10<sup>4</sup></code></li>
	<li><code>s</code> consists of digits, square brackets <code>&quot;[]&quot;</code>, negative sign <code>&#39;-&#39;</code>, and commas <code>&#39;,&#39;</code>.</li>
	<li><code>s</code> is the serialization of valid <code>NestedInteger</code>.</li>
	<li>All the values in the input are in the range <code>[-10<sup>6</sup>, 10<sup>6</sup>]</code>.</li>
</ul>
</div>

## 中文题目
<div><p>给定一个用字符串表示的整数的嵌套列表，实现一个解析它的语法分析器。</p>

<p>列表中的每个元素只可能是整数或整数嵌套列表</p>

<p><strong>提示：</strong>你可以假定这些字符串都是格式良好的：</p>

<ul>
	<li>字符串非空</li>
	<li>字符串不包含空格</li>
	<li>字符串只包含数字<code>0-9</code>、<code>[</code>、<code>-</code>、<code>,</code>、<code>]</code></li>
</ul>

<p>&nbsp;</p>

<p><strong>示例 1：</strong></p>

<pre>给定 s = &quot;324&quot;,

你应该返回一个 NestedInteger 对象，其中只包含整数值 324。
</pre>

<p><strong>示例 2：</strong></p>

<pre>给定 s = &quot;[123,[456,[789]]]&quot;,

返回一个 NestedInteger 对象包含一个有两个元素的嵌套列表：

1. 一个 integer 包含值 123
2. 一个包含两个元素的嵌套列表：
    i.  一个 integer 包含值 456
    ii. 一个包含一个元素的嵌套列表
         a. 一个 integer 包含值 789
</pre>
</div>

## 通过代码
<RecoDemo>
</RecoDemo>


## 高赞题解
设定一个`getNest()`函数用于返回一个列表类型的NestedInteger。



重要的思想是通过类的全局字符数组和一个下标值让每次调用递归函数都知道要处理哪个位置。



```java

class Solution {

    //递归函数通过字符数组和cur下标确定要处理的位置

    char[] chars;

    int cur = 0;

    public NestedInteger deserialize(String s) {

        chars = s.toCharArray();

        //本身不是一个集合而是一个整数的情况

        if(chars[0]!='[') return new NestedInteger(Integer.valueOf(s));

        //调用递归函数返回根集合

        return getNest();

    }

    public NestedInteger getNest(){

        NestedInteger nest = new NestedInteger();

        int num = 0;//num用于缓存用逗号分割的整数类型的值

        boolean negative = false;//当前记录的整数是不是负数

        while(cur!=chars.length-1){

            cur ++;

            if(chars[cur]==',') continue;

            if(chars[cur]=='[') nest.add(getNest());//遇到[递归获取子集合

            else if(chars[cur]==']') return nest;

            else if(chars[cur]=='-') negative = true;

            else{//是数字的情况

                if(negative) num = 10*num - (chars[cur]-48);

                else num = 10*num + (chars[cur]-48);

                //如果下一个字符是,或者]说明当前数字已经记录完了，需要加入集合中

                if(chars[cur+1]==','||chars[cur+1]==']'){ 

                    nest.add(new NestedInteger(num));

                    num = 0;

                    negative = false;

                }

            }

        }

        return null;

    }

}

```



`2020/06/08`编辑：写这篇题解的时候刚开始用Java刷题不久，写的代码不是很优雅，这个代码有几处地方可以修改一下让代码更清晰规范一些：



+ 这段代码中的`48`代表的就是字符`'0'`，建议使用`'0'`替换`48`。

+ `negative`是布尔型，其实可以优化成整型`sign`，后面就不需要用`if-else`进行判断，代码更加精炼。



优化后的代码如下：



```java

class Solution {

    //递归函数通过字符数组和cur下标确定要处理的位置

    char[] chars;

    int cur = 0;

    public NestedInteger deserialize(String s) {

        chars = s.toCharArray();

        //本身不是一个集合而是一个整数的情况

        if(chars[0]!='[') return new NestedInteger(Integer.valueOf(s));

        //调用递归函数返回根集合

        return getNest();

    }

    public NestedInteger getNest(){

        NestedInteger nest = new NestedInteger();

        int num = 0;//num用于缓存用逗号分割的整数类型的值

        int sign = 1;//当前记录的整数的符号，1代表整数，-1代表负数

        while(cur!=chars.length-1){

            cur ++;

            if(chars[cur]==',') continue;

            if(chars[cur]=='[') nest.add(getNest());//遇到[递归获取子集合

            else if(chars[cur]==']') return nest;

            else if(chars[cur]=='-') sign = -1;

            else{//是数字的情况

                num = 10*num + sign * (chars[cur]-'0');

                //如果下一个字符是,或者]说明当前数字已经记录完了，需要加入集合中

                if(chars[cur+1]==','||chars[cur+1]==']'){ 

                    nest.add(new NestedInteger(num));

                    num = 0;

                    sign = 1;

                }

            }

        }

        return null;

    }

}

```



## 统计信息
| 通过次数 | 提交次数 | AC比率 |
| :------: | :------: | :------: |
|    7698    |    18390    |   41.9%   |

## 提交历史
| 提交时间 | 提交结果 | 执行时间 |  内存消耗  | 语言 |
| :------: | :------: | :------: | :--------: | :--------: |


## 相似题目
|                             题目                             | 难度 |
| :----------------------------------------------------------: | :---------: |
| [扁平化嵌套列表迭代器](https://leetcode-cn.com/problems/flatten-nested-list-iterator/) | 中等|
| [三元表达式解析器](https://leetcode-cn.com/problems/ternary-expression-parser/) | 中等|
| [删除注释](https://leetcode-cn.com/problems/remove-comments/) | 中等|
