---
title: 673-æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°(Number of Longest Increasing Subsequence)
date: 2021-12-03 22:40:10
categories:
  - ä¸­ç­‰
tags:
  - æ ‘çŠ¶æ•°ç»„
  - çº¿æ®µæ ‘
  - æ•°ç»„
  - åŠ¨æ€è§„åˆ’
---

> åŸæ–‡é“¾æ¥: https://leetcode-cn.com/problems/number-of-longest-increasing-subsequence


## è‹±æ–‡åŸæ–‡
<div><p>Given an integer array&nbsp;<code>nums</code>, return <em>the number of longest increasing subsequences.</em></p>

<p><strong>Notice</strong> that the sequence has to be <strong>strictly</strong> increasing.</p>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>

<pre>
<strong>Input:</strong> nums = [1,3,5,4,7]
<strong>Output:</strong> 2
<strong>Explanation:</strong> The two longest increasing subsequences are [1, 3, 4, 7] and [1, 3, 5, 7].
</pre>

<p><strong>Example 2:</strong></p>

<pre>
<strong>Input:</strong> nums = [2,2,2,2,2]
<strong>Output:</strong> 5
<strong>Explanation:</strong> The length of longest continuous increasing subsequence is 1, and there are 5 subsequences&#39; length is 1, so output 5.

</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>1 &lt;= nums.length &lt;= 2000</code></li>
	<li><code>-10<sup>6</sup> &lt;= nums[i] &lt;= 10<sup>6</sup></code></li>
</ul>
</div>

## ä¸­æ–‡é¢˜ç›®
<div><p>ç»™å®šä¸€ä¸ªæœªæ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°ã€‚</p>

<p><strong>ç¤ºä¾‹ 1:</strong></p>

<pre>
<strong>è¾“å…¥:</strong> [1,3,5,4,7]
<strong>è¾“å‡º:</strong> 2
<strong>è§£é‡Š:</strong> æœ‰ä¸¤ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ï¼Œåˆ†åˆ«æ˜¯ [1, 3, 4, 7] å’Œ[1, 3, 5, 7]ã€‚
</pre>

<p><strong>ç¤ºä¾‹ 2:</strong></p>

<pre>
<strong>è¾“å…¥:</strong> [2,2,2,2,2]
<strong>è¾“å‡º:</strong> 5
<strong>è§£é‡Š:</strong> æœ€é•¿é€’å¢å­åºåˆ—çš„é•¿åº¦æ˜¯1ï¼Œå¹¶ä¸”å­˜åœ¨5ä¸ªå­åºåˆ—çš„é•¿åº¦ä¸º1ï¼Œå› æ­¤è¾“å‡º5ã€‚
</pre>

<p><strong>æ³¨æ„:</strong>&nbsp;ç»™å®šçš„æ•°ç»„é•¿åº¦ä¸è¶…è¿‡ 2000 å¹¶ä¸”ç»“æœä¸€å®šæ˜¯32ä½æœ‰ç¬¦å·æ•´æ•°ã€‚</p>
</div>

## é€šè¿‡ä»£ç 
<RecoDemo>
</RecoDemo>


## é«˜èµé¢˜è§£
## åºåˆ— DP

ä¸æœ´ç´ çš„ LIS é—®é¢˜ï¼ˆé—®é•¿åº¦ï¼‰ç›¸æ¯”ï¼Œæœ¬é¢˜é—®çš„æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°ã€‚

æˆ‘ä»¬åªéœ€è¦åœ¨æœ´ç´  LIS é—®é¢˜çš„åŸºç¡€ä¸Šé€šè¿‡ã€Œè®°å½•é¢å¤–ä¿¡æ¯ã€æ¥è¿›è¡Œæ±‚è§£å³å¯ã€‚

åœ¨æœ´ç´ çš„ LIS é—®é¢˜ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ **$f[i]$ ä¸ºè€ƒè™‘ä»¥ $nums[i]$ ä¸ºç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ã€‚** æœ€ç»ˆç­”æ¡ˆä¸ºæ‰€æœ‰ $f[0...(n - 1)]$ ä¸­çš„æœ€å¤§å€¼ã€‚

ä¸å¤±ä¸€èˆ¬æ€§åœ°è€ƒè™‘ $f[i]$ è¯¥å¦‚ä½•è½¬ç§»ï¼š

* ç”±äºæ¯ä¸ªæ•°éƒ½èƒ½ç‹¬è‡ªä¸€ä¸ªæˆä¸ºå­åºåˆ—ï¼Œå› æ­¤èµ·å§‹å¿…ç„¶æœ‰ $f[i] = 1$ï¼›
* æšä¸¾åŒºé—´ $[0, i)$ çš„æ‰€æœ‰æ•° $nums[j]$ï¼Œå¦‚æœæ»¡è¶³ $nums[j] < nums[i]$ï¼Œè¯´æ˜ $nums[i]$ å¯ä»¥æ¥åœ¨ $nums[j]$ åé¢å½¢æˆä¸Šå‡å­åºåˆ—ï¼Œæ­¤æ—¶ä½¿ç”¨ $f[j]$ æ›´æ–° $f[i]$ï¼Œå³æœ‰ $f[i] = f[j] + 1$ã€‚

å›åˆ°æœ¬é¢˜ï¼Œç”±äºæˆ‘ä»¬éœ€è¦æ±‚è§£çš„æ˜¯æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°ï¼Œå› æ­¤éœ€è¦é¢å¤–å®šä¹‰ **$g[i]$ ä¸ºè€ƒè™‘ä»¥ $nums[i]$ ç»“å°¾çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°ã€‚**

ç»“åˆ $f[i]$ çš„è½¬ç§»è¿‡ç¨‹ï¼Œä¸å¤±ä¸€èˆ¬æ€§åœ°è€ƒè™‘ $g[i]$ è¯¥å¦‚ä½•è½¬ç§»ï¼š

* åŒç†ï¼Œç”±äºæ¯ä¸ªæ•°éƒ½èƒ½ç‹¬è‡ªä¸€ä¸ªæˆä¸ºå­åºåˆ—ï¼Œå› æ­¤èµ·å§‹å¿…ç„¶æœ‰ $g[i] = 1$ï¼›
* æšä¸¾åŒºé—´ $[0, i)$ çš„æ‰€æœ‰æ•° $nums[j]$ï¼Œå¦‚æœæ»¡è¶³ $nums[j] < nums[i]$ï¼Œè¯´æ˜ $nums[i]$ å¯ä»¥æ¥åœ¨ $nums[j]$ åé¢å½¢æˆä¸Šå‡å­åºåˆ—ï¼Œè¿™æ—¶å€™å¯¹ $f[i]$ å’Œ $f[j] + 1$ çš„å¤§å°å…³ç³»è¿›è¡Œåˆ†æƒ…å†µè®¨è®ºï¼š
    * æ»¡è¶³ $f[i] < f[j] + 1$ï¼šè¯´æ˜ $f[i]$ ä¼šè¢« $f[j] + 1$ ç›´æ¥æ›´æ–°ï¼Œæ­¤æ—¶åŒæ­¥ç›´æ¥æ›´æ–° $g[i] = g[j]$ å³å¯ï¼›
    * æ»¡è¶³ $f[i] = f[j] + 1$ï¼šè¯´æ˜æ‰¾åˆ°äº†ä¸€ä¸ªæ–°çš„ç¬¦åˆæ¡ä»¶çš„å‰é©±ï¼Œæ­¤æ—¶å°†å€¼ç»§ç»­ç´¯åŠ åˆ°æ–¹æ¡ˆæ•°å½“ä¸­ï¼Œå³æœ‰ $g[i] += g[j]$ã€‚

åœ¨è½¬ç§»è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶è®°å½•å…¨å±€æœ€é•¿ä¸Šå‡å­åºåˆ—çš„æœ€å¤§é•¿åº¦ $max$ï¼Œæœ€ç»ˆç­”æ¡ˆä¸ºæ‰€æœ‰æ»¡è¶³ $f[i] = max$ çš„ $g[i]$ çš„ç´¯åŠ å€¼ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    public int findNumberOfLIS(int[] nums) {
        int n = nums.length;
        int[] f = new int[n], g = new int[n];
        int max = 1;
        for (int i = 0; i < n; i++) {
            f[i] = g[i] = 1;
            for (int j = 0; j < i; j++) {
                if (nums[j] < nums[i]) {
                    if (f[i] < f[j] + 1) {
                        f[i] = f[j] + 1;
                        g[i] = g[j];
                    } else if (f[i] == f[j] + 1) {
                        g[i] += g[j];
                    }
                }
            }
            max = Math.max(max, f[i]);
        }
        int ans = 0;
        for (int i = 0; i < n; i++) {
            if (f[i] == max) ans += g[i];
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## LIS é—®é¢˜çš„è´ªå¿ƒè§£ + æ ‘çŠ¶æ•°ç»„

æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæœ´ç´ çš„ LIS é—®é¢˜å­˜åœ¨è´ªå¿ƒè§£æ³•ï¼Œèƒ½å¤Ÿåœ¨ $O(n\log{n})$ å¤æ‚åº¦å†…æ±‚è§£ LIS é—®é¢˜ã€‚

åœ¨è´ªå¿ƒè§£ä¸­ï¼Œæˆ‘ä»¬ä¼šå¤šå¼€ä¸€ä¸ªè´ªå¿ƒæ•°ç»„ $q$ï¼Œç”¨æ¥è®°å½•é•¿åº¦ä¸º $len$ çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ã€Œæœ€å°ç»“å°¾å…ƒç´ ã€ä¸ºä½•å€¼ï¼š**$q[len] = x$ ä»£è¡¨é•¿åº¦ä¸º $len$ çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„æœ€å°ç»“å°¾å…ƒç´ ä¸º $x$ã€‚**

**å¯ä»¥è¯æ˜ $q$ å­˜åœ¨å•è°ƒæ€§ï¼Œå› æ­¤æ¯æ¬¡ç¡®å®š $nums[i]$ å¯ä»¥æ¥åœ¨å“ªä¸ª $nums[j]$ åé¢ä¼šå½¢æˆæœ€é•¿ä¸Šå‡å­åºåˆ—æ—¶ï¼Œå¯ä»¥é€šè¿‡ã€ŒäºŒåˆ†ã€æ¥æ‰¾åˆ°æ»¡è¶³ $nums[j] < nums[i]$ çš„æœ€å¤§ä¸‹æ ‡æ¥å®ç°ã€‚**

å¯¹äºæœ¬é¢˜ï¼Œç”±äºæˆ‘ä»¬éœ€è¦æ±‚æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸ªæ•°ï¼Œå•çº¯ä½¿ç”¨ä¸€ç»´çš„è´ªå¿ƒæ•°ç»„è®°å½•æœ€å°ç»“å°¾å…ƒç´ å¹¶ä¸è¶³ä»¥ã€‚

è€ƒè™‘å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼ŒæœŸæœ›èƒ½å–åˆ°ã€Œæœ€å¤§é•¿åº¦ã€çš„åŒæ—¶ï¼Œèƒ½å¤ŸçŸ¥é“è¿™ä¸ªã€Œæœ€å¤§é•¿åº¦ã€å¯¹åº”å¤šå°‘ä¸ªå­åºåˆ—æ•°é‡ï¼ŒåŒæ—¶æœŸæœ›è¯¥æ“ä½œå¤æ‚åº¦ä¸º $O(\log{n})$ã€‚

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œæ ‘çŠ¶æ•°ç»„ã€ç»´æŠ¤äºŒå…ƒç»„ $(len, cnt)$ ä¿¡æ¯ï¼š

1. å› ä¸ºæ•°æ®èŒƒå›´è¾ƒå¤§ï¼ˆ$-10^6 <= nums[i] <= 10^6$ï¼‰ï¼Œä½†æ•°çš„ä¸ªæ•°ä¸º $2000$ï¼Œå› æ­¤ç¬¬ä¸€æ­¥å…ˆå¯¹ $nums$ è¿›è¡Œç¦»æ•£åŒ–æ“ä½œï¼›
2. åœ¨éå† $nums$ æ—¶ï¼Œæ¯æ¬¡ä»æ ‘çŠ¶æ•°ç»„ä¸­æŸ¥è¯¢å€¼ä¸¥æ ¼å°äº $nums[i]$ ç¦»æ•£å€¼ï¼ˆåˆ©ç”¨ $nums[i]$ ç¦»æ•£åŒ–åçš„å€¼ä»ä¸ºæ­£æ•´æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŸ¥è¯¢å°äºç­‰äº $nums[i]$ ç¦»æ•£å€¼ $-1$ çš„å€¼ï¼‰çš„æœ€å¤§é•¿åº¦ï¼ŒåŠæœ€å¤§é•¿åº¦å¯¹åº”çš„æ•°é‡ï¼›
3. å¯¹äºæµç¨‹ $2$ ä¸­æŸ¥å¾—çš„ $(len, cnt)$ï¼Œç”±äº $nums[i]$ å¯ä»¥æ¥åœ¨å…¶åï¼Œå› æ­¤é¦–å…ˆé•¿åº¦åŠ ä¸€ï¼ŒåŒæ—¶æ•°é‡å°† $cnt$ ç´¯åŠ åˆ°è¯¥ç¦»æ•£å€¼ä¸­ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    int n;
    int[][] tr = new int[2010][2];
    int lowbit(int x) {
        return x & -x;
    }
    int[] query(int x) {
        int len = 0, cnt = 0;
        for (int i = x; i > 0; i -= lowbit(i)) {
            if (len == tr[i][0]) {
                cnt += tr[i][1];
            } else if (len < tr[i][0]) {
                len = tr[i][0];
                cnt = tr[i][1];
            }
        }
        return new int[]{len, cnt};
    }
    void add(int x, int[] info) {
        for (int i = x; i <= n; i += lowbit(i)) {
            int len = tr[i][0], cnt = tr[i][1];
            if (len == info[0]) {
                cnt += info[1];
            } else if (len < info[0]) {
                len = info[0];
                cnt = info[1];
            }
            tr[i][0] = len; tr[i][1] = cnt;
        }
    }
    public int findNumberOfLIS(int[] nums) {
        n = nums.length;
        // ç¦»æ•£åŒ–
        int[] tmp = nums.clone();
        Arrays.sort(tmp);
        Map<Integer, Integer> map = new HashMap<>();
        for (int i = 0, idx = 1; i < n; i++) {
            if (!map.containsKey(tmp[i])) map.put(tmp[i], idx++);
        }
        // æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ (len, cnt) ä¿¡æ¯
        for (int i = 0; i < n; i++) {
            int x = map.get(nums[i]);
            int[] info = query(x - 1);
            int len = info[0], cnt = info[1];            
            add(x, new int[]{len + 1, Math.max(cnt, 1)});
        }
        int[] ans = query(n);
        return ans[1];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## å…¶ä»–ã€Œåºåˆ— DPã€å†…å®¹

æ„çŠ¹æœªå°½ï¼Ÿå¯ä»¥å°è¯•ä¸‹é¢çš„ã€Œåºåˆ— DPã€é—®é¢˜ï¼š

| é¢˜ç›®                                                         | é¢˜è§£                                                         | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- | -------- |
| [354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](https://leetcode-cn.com/problems/russian-doll-envelopes/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/russian-doll-envelopes/solution/zui-chang-shang-sheng-zi-xu-lie-bian-xin-6s8d/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [368. æœ€å¤§æ•´é™¤å­é›†](https://leetcode-cn.com/problems/largest-divisible-subset/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/largest-divisible-subset/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-0a3jc/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [446. ç­‰å·®æ•°åˆ—åˆ’åˆ† II - å­åºåˆ—](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/solution/gong-shui-san-xie-xiang-jie-ru-he-fen-xi-ykvk/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [740. åˆ é™¤å¹¶è·å¾—ç‚¹æ•°](https://leetcode-cn.com/problems/delete-and-earn/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/delete-and-earn/solution/gong-shui-san-xie-zhuan-huan-wei-xu-lie-6c9t0/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [978. æœ€é•¿æ¹æµå­æ•°ç»„](https://leetcode-cn.com/problems/longest-turbulent-subarray/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-turbulent-subarray/solution/xiang-jie-dong-tai-gui-hua-ru-he-cai-dp-3spgj/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©      |
| [1035. ä¸ç›¸äº¤çš„çº¿](https://leetcode-cn.com/problems/uncrossed-lines/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/uncrossed-lines/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-bkaas/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1143. æœ€é•¿å…¬å…±å­åºåˆ—](https://leetcode-cn.com/problems/longest-common-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-common-subsequence/solution/gong-shui-san-xie-zui-chang-gong-gong-zi-xq0h/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1473. ç²‰åˆ·æˆ¿å­ III](https://leetcode-cn.com/problems/paint-house-iii/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/paint-house-iii/solution/gong-shui-san-xie-san-wei-dong-tai-gui-h-ud7m/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1713. å¾—åˆ°å­åºåˆ—çš„æœ€å°‘æ“ä½œæ¬¡æ•°](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-oj7yu/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |

**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/åºåˆ—-DP)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**


---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 

## ç»Ÿè®¡ä¿¡æ¯
| é€šè¿‡æ¬¡æ•° | æäº¤æ¬¡æ•° | ACæ¯”ç‡ |
| :------: | :------: | :------: |
|    50487    |    115805    |   43.6%   |

## æäº¤å†å²
| æäº¤æ—¶é—´ | æäº¤ç»“æœ | æ‰§è¡Œæ—¶é—´ |  å†…å­˜æ¶ˆè€—  | è¯­è¨€ |
| :------: | :------: | :------: | :--------: | :--------: |


## ç›¸ä¼¼é¢˜ç›®
|                             é¢˜ç›®                             | éš¾åº¦ |
| :----------------------------------------------------------: | :---------: |
| [æœ€é•¿é€’å¢å­åºåˆ—](https://leetcode-cn.com/problems/longest-increasing-subsequence/) | ä¸­ç­‰|
| [æœ€é•¿è¿ç»­é€’å¢åºåˆ—](https://leetcode-cn.com/problems/longest-continuous-increasing-subsequence/) | ç®€å•|
