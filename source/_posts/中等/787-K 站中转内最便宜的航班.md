---
title: 787-K ç«™ä¸­è½¬å†…æœ€ä¾¿å®œçš„èˆªç­(Cheapest Flights Within K Stops)
categories:
  - ä¸­ç­‰
tags:
  - æ·±åº¦ä¼˜å…ˆæœç´¢
  - å¹¿åº¦ä¼˜å…ˆæœç´¢
  - å›¾
  - åŠ¨æ€è§„åˆ’
  - æœ€çŸ­è·¯
  - å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰
abbrlink: 2421622529
date: 2021-12-03 22:32:57
---

> åŸæ–‡é“¾æ¥: https://leetcode-cn.com/problems/cheapest-flights-within-k-stops


## è‹±æ–‡åŸæ–‡
<div><p>There are <code>n</code> cities connected by some number of flights. You are given an array <code>flights</code> where <code>flights[i] = [from<sub>i</sub>, to<sub>i</sub>, price<sub>i</sub>]</code> indicates that there is a flight from city <code>from<sub>i</sub></code> to city <code>to<sub>i</sub></code> with cost <code>price<sub>i</sub></code>.</p>

<p>You are also given three integers <code>src</code>, <code>dst</code>, and <code>k</code>, return <em><strong>the cheapest price</strong> from </em><code>src</code><em> to </em><code>dst</code><em> with at most </em><code>k</code><em> stops. </em>If there is no such route, return<em> </em><code>-1</code>.</p>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>
<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" style="height: 360px; width: 492px;" />
<pre>
<strong>Input:</strong> n = 3, flights = [[0,1,100],[1,2,100],[0,2,500]], src = 0, dst = 2, k = 1
<strong>Output:</strong> 200
<strong>Explanation:</strong> The graph is shown.
The cheapest price from city <code>0</code> to city <code>2</code> with at most 1 stop costs 200, as marked red in the picture.
</pre>

<p><strong>Example 2:</strong></p>
<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" style="height: 360px; width: 492px;" />
<pre>
<strong>Input:</strong> n = 3, flights = [[0,1,100],[1,2,100],[0,2,500]], src = 0, dst = 2, k = 0
<strong>Output:</strong> 500
<strong>Explanation:</strong> The graph is shown.
The cheapest price from city <code>0</code> to city <code>2</code> with at most 0 stop costs 500, as marked blue in the picture.
</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>1 &lt;= n &lt;= 100</code></li>
	<li><code>0 &lt;= flights.length &lt;= (n * (n - 1) / 2)</code></li>
	<li><code>flights[i].length == 3</code></li>
	<li><code>0 &lt;= from<sub>i</sub>, to<sub>i</sub> &lt; n</code></li>
	<li><code>from<sub>i</sub> != to<sub>i</sub></code></li>
	<li><code>1 &lt;= price<sub>i</sub> &lt;= 10<sup>4</sup></code></li>
	<li>There will not be any multiple flights between two cities.</li>
	<li><code>0 &lt;= src, dst, k &lt; n</code></li>
	<li><code>src != dst</code></li>
</ul>
</div>

## ä¸­æ–‡é¢˜ç›®
<div><p>æœ‰ <code>n</code> ä¸ªåŸå¸‚é€šè¿‡ä¸€äº›èˆªç­è¿æ¥ã€‚ç»™ä½ ä¸€ä¸ªæ•°ç»„&nbsp;<code>flights</code> ï¼Œå…¶ä¸­&nbsp;<code>flights[i] = [from<sub>i</sub>, to<sub>i</sub>, price<sub>i</sub>]</code> ï¼Œè¡¨ç¤ºè¯¥èˆªç­éƒ½ä»åŸå¸‚ <code>from<sub>i</sub></code> å¼€å§‹ï¼Œä»¥ä»·æ ¼ <code>price<sub>i</sub></code> æŠµè¾¾ <code>to<sub>i</sub></code>ã€‚</p>

<p>ç°åœ¨ç»™å®šæ‰€æœ‰çš„åŸå¸‚å’Œèˆªç­ï¼Œä»¥åŠå‡ºå‘åŸå¸‚ <code>src</code> å’Œç›®çš„åœ° <code>dst</code>ï¼Œä½ çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°å‡ºä¸€æ¡æœ€å¤šç»è¿‡ <code>k</code>&nbsp;ç«™ä¸­è½¬çš„è·¯çº¿ï¼Œä½¿å¾—ä» <code>src</code> åˆ° <code>dst</code> çš„ <strong>ä»·æ ¼æœ€ä¾¿å®œ</strong> ï¼Œå¹¶è¿”å›è¯¥ä»·æ ¼ã€‚ å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„è·¯çº¿ï¼Œåˆ™è¾“å‡º <code>-1</code>ã€‚</p>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥:</strong> 
n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]
src = 0, dst = 2, k = 1
<strong>è¾“å‡º:</strong> 200
<strong>è§£é‡Š:</strong> 
åŸå¸‚èˆªç­å›¾å¦‚ä¸‹
<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" style="height: 180px; width: 246px;" />

ä»åŸå¸‚ 0 åˆ°åŸå¸‚ 2 åœ¨ 1 ç«™ä¸­è½¬ä»¥å†…çš„æœ€ä¾¿å®œä»·æ ¼æ˜¯ 200ï¼Œå¦‚å›¾ä¸­çº¢è‰²æ‰€ç¤ºã€‚</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥:</strong> 
n = 3, edges = [[0,1,100],[1,2,100],[0,2,500]]
src = 0, dst = 2, k = 0
<strong>è¾“å‡º:</strong> 500
<strong>è§£é‡Š:</strong> 
åŸå¸‚èˆªç­å›¾å¦‚ä¸‹
<img alt="" src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/02/16/995.png" style="height: 180px; width: 246px;" />

ä»åŸå¸‚ 0 åˆ°åŸå¸‚ 2 åœ¨ 0 ç«™ä¸­è½¬ä»¥å†…çš„æœ€ä¾¿å®œä»·æ ¼æ˜¯ 500ï¼Œå¦‚å›¾ä¸­è“è‰²æ‰€ç¤ºã€‚</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= n &lt;= 100</code></li>
	<li><code>0 &lt;= flights.length &lt;= (n * (n - 1) / 2)</code></li>
	<li><code>flights[i].length == 3</code></li>
	<li><code>0 &lt;= from<sub>i</sub>, to<sub>i</sub> &lt; n</code></li>
	<li><code>from<sub>i</sub> != to<sub>i</sub></code></li>
	<li><code>1 &lt;= price<sub>i</sub> &lt;= 10<sup>4</sup></code></li>
	<li>èˆªç­æ²¡æœ‰é‡å¤ï¼Œä¸”ä¸å­˜åœ¨è‡ªç¯</li>
	<li><code>0 &lt;= src, dst, k &lt; n</code></li>
	<li><code>src != dst</code></li>
</ul>
</div>

## é€šè¿‡ä»£ç 
<RecoDemo>
</RecoDemo>


## é«˜èµé¢˜è§£
## åŸºæœ¬åˆ†æ

ä»é¢˜é¢çœ‹å°±èƒ½çŸ¥é“ï¼Œè¿™æ˜¯ä¸€ç±»ã€Œæœ‰é™åˆ¶ã€çš„æœ€çŸ­è·¯é—®é¢˜ã€‚

ã€Œé™åˆ¶æœ€å¤šç»è¿‡ä¸è¶…è¿‡ $k$ ä¸ªç‚¹ã€ç­‰ä»·äºã€Œé™åˆ¶æœ€å¤šä¸è¶…è¿‡ $k + 1$ æ¡è¾¹ã€ï¼Œè€Œè§£å†³ã€Œæœ‰è¾¹æ•°é™åˆ¶çš„æœ€çŸ­è·¯é—®é¢˜ã€æ˜¯ SPFA æ‰€ä¸èƒ½å–ä»£ Bellman Ford ç®—æ³•çš„ç»å…¸åº”ç”¨ä¹‹ä¸€ï¼ˆSPFA èƒ½åšï¼Œä½†ä¸èƒ½ç›´æ¥åšï¼‰ã€‚

**Bellman Ford/SPFA éƒ½æ˜¯åŸºäºåŠ¨æ€è§„åˆ’ï¼Œå…¶åŸå§‹çš„çŠ¶æ€å®šä¹‰ä¸º $f[i][k]$ ä»£è¡¨ä»èµ·ç‚¹åˆ° $i$ ç‚¹ï¼Œä¸”ç»è¿‡æœ€å¤š $k$ æ¡è¾¹çš„æœ€çŸ­è·¯å¾„ã€‚è¿™æ ·çš„çŠ¶æ€å®šä¹‰å¼•å¯¼æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Bellman Ford æ¥è§£å†³æœ‰è¾¹æ•°é™åˆ¶çš„æœ€çŸ­è·¯é—®é¢˜ã€‚**

**åŒæ ·å¤šæºæ±‡æœ€çŸ­è·¯ç®—æ³• Floyd ä¹Ÿæ˜¯åŸºäºåŠ¨æ€è§„åˆ’ï¼Œå…¶åŸå§‹çš„ä¸‰ç»´çŠ¶æ€å®šä¹‰ä¸º $f[i][j][k]$ ä»£è¡¨ä»ç‚¹ $i$ åˆ°ç‚¹ $j$ï¼Œä¸”ç»è¿‡çš„æ‰€æœ‰ç‚¹ç¼–å·ä¸ä¼šè¶…è¿‡ $k$ï¼ˆå³å¯ä½¿ç”¨ç‚¹ç¼–å·èŒƒå›´ä¸º $[1, k]$ï¼‰çš„æœ€çŸ­è·¯å¾„ã€‚è¿™æ ·çš„çŠ¶æ€å®šä¹‰å¼•å¯¼æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ Floyd æ±‚æœ€å°ç¯æˆ–è€…æ±‚â€œé‡å¿ƒç‚¹â€ï¼ˆå³åˆ é™¤è¯¥ç‚¹åï¼Œæœ€çŸ­è·¯å€¼ä¼šå˜å¤§ï¼‰ã€‚**

å¦‚æœä½ å¯¹å‡ ç±»æœ€çŸ­ç®—æ³•ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥çœ‹ [è¿™é‡Œ](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247488007&idx=1&sn=9d0dcfdf475168d26a5a4bd6fcd3505d&chksm=fd9cb918caeb300e1c8844583db5c5318a89e60d8d552747ff8c2256910d32acd9013c93058f&token=754098973&lang=zh_CN#rd)ï¼Œé‡Œé¢æ¶µç›–æ‰€æœ‰çš„ã€Œæœ€çŸ­è·¯ç®—æ³•ã€å’Œã€Œå­˜å›¾æ–¹å¼ã€ã€‚
 
---

## Bellman Ford + é‚»æ¥çŸ©é˜µ

å›åˆ°æœ¬é¢˜ï¼Œã€Œé™åˆ¶æœ€å¤šç»è¿‡ä¸è¶…è¿‡ $k$ ä¸ªç‚¹ã€ç­‰ä»·äºã€Œé™åˆ¶æœ€å¤šä¸è¶…è¿‡ $k + 1$ æ¡è¾¹ã€ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ Bellman Ford æ¥æ±‚è§£ã€‚

ç‚¹çš„æ•°é‡åªæœ‰ $100$ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€Œé‚»æ¥çŸ©é˜µã€çš„æ–¹å¼è¿›è¡Œå­˜å›¾ã€‚

> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨éå†æ‰€æœ‰çš„â€œç‚¹å¯¹/è¾¹â€è¿›è¡Œæ¾å¼›æ“ä½œå‰ï¼Œéœ€è¦å…ˆå¯¹ $dist$ è¿›è¡Œå¤‡ä»½ï¼Œå¦åˆ™ä¼šå‡ºç°ã€Œæœ¬æ¬¡æ¾å¼›æ“ä½œæ‰€ä½¿ç”¨åˆ°çš„è¾¹ï¼Œä¹Ÿæ˜¯åœ¨åŒä¸€æ¬¡è¿­ä»£æ‰€æ›´æ–°çš„ã€ï¼Œä»è€Œä¸æ»¡è¶³è¾¹æ•°é™åˆ¶çš„è¦æ±‚ã€‚
ä¸¾ä¸ª ğŸŒ°ï¼Œä¾‹å¦‚æœ¬æ¬¡æ¾å¼›æ“ä½œä½¿ç”¨äº†ä» $a$ åˆ° $b$ çš„å½“å‰æœ€çŸ­è·ç¦»æ¥æ›´æ–° $dist[b]$ï¼Œç›´æ¥ä½¿ç”¨ $dist[a]$ çš„è¯ï¼Œä¸èƒ½ç¡®ä¿ $dist[a]$ ä¸æ˜¯åœ¨åŒä¸€æ¬¡è¿­ä»£ä¸­æ‰€æ›´æ–°ï¼Œå¦‚æœ $dist[a]$ æ˜¯åŒä¸€æ¬¡è¿­ä»£æ‰€æ›´æ–°çš„è¯ï¼Œé‚£ä¹ˆä½¿ç”¨çš„è¾¹æ•°å°†ä¼šå¤§äº $k$ æ¡ã€‚
å› æ­¤åœ¨æ¯æ¬¡è¿­ä»£å¼€å§‹å‰ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å¯¹ $dist$ è¿›è¡Œå¤‡ä»½ï¼Œåœ¨è¿­ä»£æ—¶ä½¿ç”¨å¤‡ä»½æ¥è¿›è¡Œæ¾å¼›æ“ä½œã€‚

![image.png](../images/cheapest-flights-within-k-stops-0.png)

ä»£ç ï¼š
```Java []
class Solution {
    int N = 110, INF = 0x3f3f3f3f;
    int[][] g = new int[N][N];
    int[] dist = new int[N];
    int n, m, s, t, k;
    public int findCheapestPrice(int _n, int[][] flights, int _src, int _dst, int _k) {
        n = _n; s = _src; t = _dst; k = _k + 1;
        for (int i = 0; i < N; i++) {
            for (int j = 0; j < N; j++) {
                g[i][j] = i == j ? 0 : INF;
            }
        }
        for (int[] f : flights) {
            g[f[0]][f[1]] = f[2];
        }
        int ans = bf();
        return ans > INF / 2 ? -1 : ans;
    }
    int bf() {
        Arrays.fill(dist, INF);
        dist[s] = 0;
        for (int limit = 0; limit < k; limit++) {
            int[] clone = dist.clone();
            for (int i = 0; i < n; i++) {
                for (int j = 0; j < n; j++) {
                    dist[j] = Math.min(dist[j], clone[i] + g[i][j]);
                }
            }
        }
        return dist[t];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(k * n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$


---

## Bellman Ford + ç±»

æˆ‘ä»¬çŸ¥é“ Bellman Ford éœ€è¦éå†æ‰€æœ‰çš„è¾¹ï¼Œè€Œä½¿ç”¨ã€Œé‚»æ¥çŸ©é˜µã€çš„å­˜å›¾æ–¹å¼è®©æˆ‘ä»¬ä¸å¾—ä¸éå†æ‰€æœ‰çš„ç‚¹å¯¹ï¼Œå¤æ‚åº¦ä¸º $O(n^2)$ã€‚

è€Œè¾¹çš„æ•°é‡ $m$ çš„æ•°æ®èŒƒå›´ä¸º $0 <= flights.length <= (n * (n - 1) / 2)$ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œç±»ã€çš„æ–¹å¼è¿›è¡Œå­˜å›¾ï¼Œä»è€Œç¡®ä¿åœ¨éå†æ‰€æœ‰è¾¹çš„æ—¶å€™ï¼Œå¤æ‚åº¦ä¸¥æ ¼ä¸º $O(m)$ï¼Œè€Œä¸æ˜¯ $O(n^2)$ã€‚

![image.png](../images/cheapest-flights-within-k-stops-1.png)

ä»£ç ï¼š
```Java []
class Solution {
    class Edge {
        int x, y, w;
        Edge(int _x, int _y, int _w) {
            x = _x; y = _y; w = _w;
        }
    }
    int N = 110, INF = 0x3f3f3f3f;
    int[] dist = new int[N];
    List<Edge> list = new ArrayList<>();
    int n, m, s, t, k;
    public int findCheapestPrice(int _n, int[][] flights, int _src, int _dst, int _k) {
        n = _n; s = _src; t = _dst; k = _k + 1;
        for (int[] f : flights) {
            list.add(new Edge(f[0], f[1], f[2]));
        }
        m = list.size();
        int ans = bf();
        return ans > INF / 2 ? -1 : ans;
    }
    int bf() {
        Arrays.fill(dist, INF);
        dist[s] = 0;
        for (int i = 0; i < k; i++) {
            int[] clone = dist.clone();
            for (Edge e : list) {
                int x = e.x, y = e.y, w = e.w;
                dist[y] = Math.min(dist[y], clone[x] + w);
            }
        }
        return dist[t];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå…±è¿›è¡Œ $k + 1$ æ¬¡è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£å¤‡ä»½æ•°ç»„å¤æ‚åº¦ä¸º $O(n)$ï¼Œç„¶åéå†æ‰€æœ‰çš„è¾¹è¿›è¡Œæ¾å¼›æ“ä½œï¼Œå¤æ‚åº¦ä¸º $O(m)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(k * (n + m))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n + m)$

---

## Bellman Ford

æ›´è¿›ä¸€æ­¥ï¼Œç”±äº Bellman Ford æ ¸å¿ƒæ“ä½œéœ€è¦éå†æ‰€æœ‰çš„è¾¹ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ $flights$ æ•°ç»„ä½œä¸ºå­˜å›¾ä¿¡æ¯ï¼Œè€Œæ— é¡»é¢å¤–å­˜å›¾ã€‚

![image.png](../images/cheapest-flights-within-k-stops-2.png)

ä»£ç ï¼š
```Java []
class Solution {
    int N = 110, INF = 0x3f3f3f3f;
    int[] dist = new int[N];
    public int findCheapestPrice(int n, int[][] flights, int src, int dst, int k) {
        Arrays.fill(dist, INF);
        dist[src] = 0;
        for (int limit = 0; limit < k + 1; limit++) {
            int[] clone = dist.clone();
            for (int[] f : flights) {
                int x = f[0], y = f[1], w = f[2];
                dist[y] = Math.min(dist[y], clone[x] + w);
            }
        }
        return dist[dst] > INF / 2 ? -1 : dist[dst];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå…±è¿›è¡Œ $k + 1$ æ¬¡è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£å¤‡ä»½æ•°ç»„å¤æ‚åº¦ä¸º $O(n)$ï¼Œç„¶åéå†æ‰€æœ‰çš„è¾¹è¿›è¡Œæ¾å¼›æ“ä½œï¼Œå¤æ‚åº¦ä¸º $O(m)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(k * (n + m))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 

## ç»Ÿè®¡ä¿¡æ¯
| é€šè¿‡æ¬¡æ•° | æäº¤æ¬¡æ•° | ACæ¯”ç‡ |
| :------: | :------: | :------: |
|    44412    |    113932    |   39.0%   |

## æäº¤å†å²
| æäº¤æ—¶é—´ | æäº¤ç»“æœ | æ‰§è¡Œæ—¶é—´ |  å†…å­˜æ¶ˆè€—  | è¯­è¨€ |
| :------: | :------: | :------: | :--------: | :--------: |


## ç›¸ä¼¼é¢˜ç›®
|                             é¢˜ç›®                             | éš¾åº¦ |
| :----------------------------------------------------------: | :---------: |
| [æœ€å¤§ä¼‘å‡å¤©æ•°](https://leetcode-cn.com/problems/maximum-vacation-days/) | å›°éš¾|
