---
title: 519-éšæœºç¿»è½¬çŸ©é˜µ(Random Flip Matrix)
categories:
  - ä¸­ç­‰
tags:
  - æ°´å¡˜æŠ½æ ·
  - å“ˆå¸Œè¡¨
  - æ•°å­¦
  - éšæœºåŒ–
abbrlink: 2084264392
date: 2021-12-03 22:31:06
---

> åŸæ–‡é“¾æ¥: https://leetcode-cn.com/problems/random-flip-matrix


## è‹±æ–‡åŸæ–‡
<div><p>There is an <code>m x n</code> binary grid <code>matrix</code> with all the values set <code>0</code> initially. Design an algorithm to randomly pick an index <code>(i, j)</code> where <code>matrix[i][j] == 0</code> and flips it to <code>1</code>. All the indices <code>(i, j)</code> where <code>matrix[i][j] == 0</code> should be equally likely to be returned.</p>

<p>Optimize your algorithm to minimize the number of calls made to the <strong>built-in</strong> random function of your language and optimize the time and space complexity.</p>

<p>Implement the <code>Solution</code> class:</p>

<ul>
	<li><code>Solution(int m, int n)</code> Initializes the object with the size of the binary matrix <code>m</code> and <code>n</code>.</li>
	<li><code>int[] flip()</code> Returns a random index <code>[i, j]</code> of the matrix where <code>matrix[i][j] == 0</code> and flips it to <code>1</code>.</li>
	<li><code>void reset()</code> Resets all the values of the matrix to be <code>0</code>.</li>
</ul>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>

<pre>
<strong>Input</strong>
[&quot;Solution&quot;, &quot;flip&quot;, &quot;flip&quot;, &quot;flip&quot;, &quot;reset&quot;, &quot;flip&quot;]
[[3, 1], [], [], [], [], []]
<strong>Output</strong>
[null, [1, 0], [2, 0], [0, 0], null, [2, 0]]

<strong>Explanation</strong>
Solution solution = new Solution(3, 1);
solution.flip();  // return [1, 0], [0,0], [1,0], and [2,0] should be equally likely to be returned.
solution.flip();  // return [2, 0], Since [1,0] was returned, [2,0] and [0,0]
solution.flip();  // return [0, 0], Based on the previously returned indices, only [0,0] can be returned.
solution.reset(); // All the values are reset to 0 and can be returned.
solution.flip();  // return [2, 0], [0,0], [1,0], and [2,0] should be equally likely to be returned.
</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>1 &lt;= m, n &lt;= 10<sup>4</sup></code></li>
	<li>There will be at least one free cell for each call to <code>flip</code>.</li>
	<li>At most <code>1000</code> calls will be made to <code>flip</code> and <code>reset</code>.</li>
</ul>
</div>

## ä¸­æ–‡é¢˜ç›®
<div><p>ç»™ä½ ä¸€ä¸ª <code>m x n</code> çš„äºŒå…ƒçŸ©é˜µ <code>matrix</code> ï¼Œä¸”æ‰€æœ‰å€¼è¢«åˆå§‹åŒ–ä¸º <code>0</code> ã€‚è¯·ä½ è®¾è®¡ä¸€ä¸ªç®—æ³•ï¼Œéšæœºé€‰å–ä¸€ä¸ªæ»¡è¶³&nbsp;<code>matrix[i][j] == 0</code> çš„ä¸‹æ ‡&nbsp;<code>(i, j)</code> ï¼Œå¹¶å°†å®ƒçš„å€¼å˜ä¸º <code>1</code> ã€‚æ‰€æœ‰æ»¡è¶³ <code>matrix[i][j] == 0</code> çš„ä¸‹æ ‡ <code>(i, j)</code> è¢«é€‰å–çš„æ¦‚ç‡åº”å½“å‡ç­‰ã€‚</p>

<p>å°½é‡æœ€å°‘è°ƒç”¨å†…ç½®çš„éšæœºå‡½æ•°ï¼Œå¹¶ä¸”ä¼˜åŒ–æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ã€‚</p>

<p>å®ç° <code>Solution</code> ç±»ï¼š</p>

<ul>
	<li><code>Solution(int m, int n)</code> ä½¿ç”¨äºŒå…ƒçŸ©é˜µçš„å¤§å° <code>m</code> å’Œ <code>n</code> åˆå§‹åŒ–è¯¥å¯¹è±¡</li>
	<li><code>int[] flip()</code> è¿”å›ä¸€ä¸ªæ»¡è¶³&nbsp;<code>matrix[i][j] == 0</code> çš„éšæœºä¸‹æ ‡ <code>[i, j]</code> ï¼Œå¹¶å°†å…¶å¯¹åº”æ ¼å­ä¸­çš„å€¼å˜ä¸º <code>1</code></li>
	<li><code>void reset()</code> å°†çŸ©é˜µä¸­æ‰€æœ‰çš„å€¼é‡ç½®ä¸º <code>0</code></li>
</ul>

<p>&nbsp;</p>

<p><strong>ç¤ºä¾‹ï¼š</strong></p>

<pre>
<strong>è¾“å…¥</strong>
["Solution", "flip", "flip", "flip", "reset", "flip"]
[[3, 1], [], [], [], [], []]
<strong>è¾“å‡º</strong>
[null, [1, 0], [2, 0], [0, 0], null, [2, 0]]

<strong>è§£é‡Š</strong>
Solution solution = new Solution(3, 1);
solution.flip();  // è¿”å› [1, 0]ï¼Œæ­¤æ—¶è¿”å› [0,0]ã€[1,0] å’Œ [2,0] çš„æ¦‚ç‡åº”å½“ç›¸åŒ
solution.flip();  // è¿”å› [2, 0]ï¼Œå› ä¸º [1,0] å·²ç»è¿”å›è¿‡äº†ï¼Œæ­¤æ—¶è¿”å› [2,0] å’Œ [0,0] çš„æ¦‚ç‡åº”å½“ç›¸åŒ
solution.flip();  // è¿”å› [0, 0]ï¼Œæ ¹æ®å‰é¢å·²ç»è¿”å›è¿‡çš„ä¸‹æ ‡ï¼Œæ­¤æ—¶åªèƒ½è¿”å› [0,0]
solution.reset(); // æ‰€æœ‰å€¼éƒ½é‡ç½®ä¸º 0 ï¼Œå¹¶å¯ä»¥å†æ¬¡é€‰æ‹©ä¸‹æ ‡è¿”å›
solution.flip();  // è¿”å› [2, 0]ï¼Œæ­¤æ—¶è¿”å› [0,0]ã€[1,0] å’Œ [2,0] çš„æ¦‚ç‡åº”å½“ç›¸åŒ</pre>

<p>&nbsp;</p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 &lt;= m, n &lt;= 10<sup>4</sup></code></li>
	<li>æ¯æ¬¡è°ƒç”¨<code>flip</code> æ—¶ï¼ŒçŸ©é˜µä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªå€¼ä¸º 0 çš„æ ¼å­ã€‚</li>
	<li>æœ€å¤šè°ƒç”¨ <code>1000</code> æ¬¡ <code>flip</code> å’Œ <code>reset</code> æ–¹æ³•ã€‚</li>
</ul>
</div>

## é€šè¿‡ä»£ç 
<RecoDemo>
</RecoDemo>


## é«˜èµé¢˜è§£
## åŒæŒ‡é’ˆ

çŸ©é˜µå¤§å°çš„æ•°æ®èŒƒå›´ä¸º $10^4$ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨çœŸå®æ„å»ºçŸ©é˜µçš„åšæ³•æ¥åšï¼ŒåŒæ—¶åˆ©ç”¨äºŒç»´çš„åæ ‡èƒ½å¤Ÿå”¯ä¸€å¯¹åº”å‡ºç¼–å·ï¼ˆ$idx = row * n + col$ï¼‰ï¼Œå¯ä»¥å°†é—®é¢˜è½¬æ¢ä¸ºä¸€ç»´é—®é¢˜ã€‚

ä¸€ä¸ªæ¯”è¾ƒå–å·§çš„åšæ³•æ˜¯ï¼šåˆ©ç”¨è°ƒç”¨æ¬¡æ•°åªæœ‰ $10^3$ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $[0, m * nï¼‰$ èŒƒå›´å†…éšæœºå‡ºä¸€ä¸ªä¸‹æ ‡ $idx$ï¼ˆå¯¹åº”çŸ©é˜µçš„æŸä¸ªå…·ä½“ä½ç½®ï¼‰ï¼Œç„¶åä» $idx$ å¾€ä¸¤è¾¹è¿›è¡Œæ‰«æï¼Œæ‰¾åˆ°æœ€è¿‘ä¸€ä¸ªæœªè¢«ä½¿ç”¨çš„ä½ç½®ï¼Œå°†å…¶è¿›è¡Œæ ‡è®°ç¿»è½¬å¹¶è¿”å›ã€‚

è¯¥åšæ³•ç›¸æ¯”äºä¸€ç›´éšæœºçš„ã€Œæ‹’ç»é‡‡æ ·ã€åšæ³•ï¼Œèƒ½å¤Ÿç¡®ä¿å•æ¬¡ `flip` æ“ä½œä¸­åªä¼šè°ƒç”¨ä¸€æ¬¡éšæœºæ–¹æ³•ï¼ŒåŒæ—¶åˆ©ç”¨çŸ©é˜µåªæœ‰ $10^3$ ä¸ªä½ç½®è¢«ç¿»è½¬ï¼Œå› è€Œå¤æ‚åº¦ä¸Šå…·æœ‰ä¿è¯ï¼Œä½†æ¯æ¬¡ `flip` å¹¶éç­‰æ¦‚ç‡ã€‚

ä»£ç ï¼š
```Java []
class Solution {
    int m, n;
    Set<Integer> set = new HashSet<>();
    Random random = new Random(300);
    public Solution(int _m, int _n) {
        m = _m; n = _n;
    }
    public int[] flip() {
        int a = random.nextInt(m * n), b = a;
        while (a >= 0 && set.contains(a)) a--;
        while (b < m * n && set.contains(b)) b++;
        int c = a >= 0 && !set.contains(a) ? a : b;
        set.add(c);
        return new int[]{c / n, c % n};
    }
    public void reset() {
        set.clear();
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤æœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $C = 1000$ï¼Œå³çŸ©é˜µä¸­æœ€å¤šæœ‰ $C$ ä¸ªä½ç½®è¢«ç¿»è½¬ã€‚`flip` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(C)$ï¼›`reset` å¤æ‚åº¦ä¸º $O(C)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(C)$

---

## å“ˆå¸Œè¡¨ + swap

åœ¨è§£æ³•ä¸€ä¸­ï¼Œæˆ‘ä»¬å°†äºŒç»´é—®é¢˜è½¬åŒ–ä¸ºäº†ä¸€ç»´é—®é¢˜ã€‚

èµ·å§‹æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ $[0, m * n)$ è¿™è¿ç»­ä¸€æ®µçš„åŒºé—´å†…è¿›è¡Œéšæœºï¼Œä½†å½“æˆ‘ä»¬ç»è¿‡äº†å¤šæ¬¡ç¿»è½¬åï¼Œè¯¥åŒºé—´å†…çš„æŸäº›ä½ç½®ä¼šè¢«æ–­å¼€ï¼Œä½¿å¾—æ•°ç»„ä¸å†è¿ç»­ã€‚

å¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æ¯æ¬¡éšæœºæ—¶éƒ½é‡‡ç”¨èµ·å§‹çš„æ–¹å¼ï¼ˆåœ¨è¿ç»­ä¸€æ®µå†…è¿›è¡Œéšæœºï¼‰ï¼Œéœ€è¦ç¡®ä¿æŸäº›ä½ç½®è¢«ç¿»è½¬åï¼Œå‰©ä½™ä½ç½®ä»æ˜¯è¿ç»­ã€‚

å…·ä½“çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€å¤šè®°å½•ä¸€å±‚æ˜ å°„å…³ç³»ï¼šèµ·å§‹æ—¶æ‰€æœ‰ä½ç½®æœªè¢«ç¿»è½¬ï¼Œæˆ‘ä»¬è§„å®šæœªè¢«ç¿»è½¬çš„ä½ç½®å…¶æ˜ å°„å€¼ä¸ºç¼–å·æœ¬èº«ï¼ˆ$idx = row * n + col$ï¼‰ï¼Œç”±äºæœªè¢«ç¿»è½¬çš„éƒ¨åˆ†å…·æœ‰ç­‰å€¼æ˜ å°„å…³ç³»ï¼Œå› æ­¤æ— é¡»åœ¨å“ˆå¸Œè¡¨ä¸­çœŸå®å­˜å‚¨ã€‚å½“éšæœºåˆ°æŸä¸ªä½ç½® $idx$ æ—¶ï¼Œè¿›è¡Œåˆ†æƒ…å†µè®¨è®ºï¼š

* è¯¥ä½ç½®æœªè¢«å“ˆå¸Œè¡¨çœŸå®è®°å½•ï¼ˆæœªè¢«ç¿»è½¬ï¼‰ï¼šè¯´æ˜ $idx$ å¯è¢«ç›´æ¥ä½¿ç”¨ï¼Œä½¿ç”¨ $idx$ ä½œä¸ºæœ¬æ¬¡éšæœºç‚¹ã€‚åŒæ—¶å°†å³ç«¯ç‚¹ï¼ˆæœªè¢«ä½¿ç”¨çš„ï¼‰ä½ç½®çš„æ˜ å°„å€¼æ”¾åˆ°è¯¥ä½ç½®ï¼Œå°†å³ç«¯ç‚¹å·¦ç§»ã€‚ç¡®ä¿ä¸‹æ¬¡å†éšæœºåˆ° $idx$ï¼Œä»èƒ½ç›´æ¥ä½¿ç”¨ $idx$ çš„æ˜ å°„å€¼ï¼ŒåŒæ—¶ç»´æŠ¤äº†éšæœºåŒºé—´çš„è¿ç»­æ€§ï¼›
* è¯¥ä½ç½®å·²è¢«å“ˆå¸Œè¡¨çœŸå®è®°å½•ï¼ˆå·²è¢«ç¿»è½¬ï¼‰ï¼šæ­¤æ—¶ç›´æ¥ä½¿ç”¨ $idx$ å­˜å‚¨çš„æ˜ å°„å€¼ï¼ˆä¸Šä¸€æ¬¡äº¤æ¢æ—¶çš„å³ç«¯ç‚¹æ˜ å°„å€¼ï¼‰å³å¯ï¼Œç„¶åç”¨æ–°çš„å³ç«¯ç‚¹æ˜ å°„å€¼å°†å…¶è¿›è¡Œè¦†ç›–ï¼Œæ›´æ–°å³ç«¯ç‚¹ã€‚ç¡®ä¿ä¸‹æ¬¡å†éšæœºåˆ° $idx$ï¼Œä»èƒ½ç›´æ¥ä½¿ç”¨ $idx$ çš„æ˜ å°„å€¼ï¼ŒåŒæ—¶ç»´æŠ¤äº†éšæœºåŒºé—´çš„è¿ç»­æ€§ã€‚


ä»£ç ï¼š
```Java []
class Solution {
    int m, n, cnt; // cnt ä¸ºå‰©ä½™æ•°ä¸ªæ•°ï¼ŒåŒæ—¶ cnt - 1 ä¸ºåŒºé—´å³ç«¯ç‚¹ä½ç½®
    Map<Integer, Integer> map = new HashMap<>();
    Random random = new Random(300);
    public Solution(int _m, int _n) {
        m = _m; n = _n; cnt = m * n;
    }
    public int[] flip() {
        int x = random.nextInt(cnt--);
        int idx = map.getOrDefault(x, x);
        map.put(x, map.getOrDefault(cnt, cnt));
        return new int[]{idx / n, idx % n};
    }
    public void reset() {
        cnt = m * n;
        map.clear();
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤æœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $C = 1000$ï¼Œå³çŸ©é˜µä¸­æœ€å¤šæœ‰ $C$ ä¸ªä½ç½®è¢«ç¿»è½¬ã€‚`flip` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(1)$ï¼›`reset` å¤æ‚åº¦ä¸º $O(C)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(C)$

---

## æœ€å

ä»Šå¤©æ˜¯è¿ç»­æ›´æ–°æ¯æ—¥ä¸€é¢˜é¢˜è§£çš„ç¬¬ $300$ å¤© ğŸ‰ ğŸ‰

å‰å¤©æ„Ÿæ©èŠ‚çš„æ—¶å€™æ”¶åˆ°äº†å¾ˆå¤šåŒå­¦çš„æ„Ÿè°¢ç•™è¨€ï¼Œå…¶å®æ˜¯æˆ‘æ›´åº”è¯¥æ„Ÿè°¢å¤§å®¶ï¼Œæ²¡æœ‰ä½ ä»¬æˆ–è®¸æˆ‘ä¸ä¼šåšæŒè¿™ä¹ˆä¹…ã€‚æ˜¯ä½ ä»¬æ¯å¤©çš„åé¦ˆä¸é™ªä¼´ï¼Œå¼ºåŒ–äº†æˆ‘è®¤ä¸ºåšè¿™äº‹å¾ˆæœ‰æ„ä¹‰çš„æƒ³æ³•ã€‚

ç‰¹æ®Šçš„æ—¥å­ï¼Œå¼€ä¸ªèµèµæ‹ä¸ªå…¨å®¶ç¦ï¼Œä»ç„¶æ˜¯ã€Œ**å­¦ç”Ÿå…è´¹ï¼Œéå­¦ç”Ÿæ˜¯å¦èµèµéƒ½èƒ½çœ‹**ã€çš„åŸåˆ™ã€‚

å¦å¤–éœ€è¦å¼ºè°ƒï¼šåŠ›æ‰£ã€Œèµèµã€è¡Œä¸ºçš„å‘ç”Ÿï¼Œå¿…é¡»åŸºäºã€Œä½ ååˆ†å–œæ¬¢è¯¥ä½œè€…ã€&ã€Œä½ ååˆ†å–œæ¬¢è¯¥å¹³å°ã€ï¼Œä¸¤è€…ç¼ºä¸€ä¸å¯ã€‚

å¦‚æœä½ ç¡®å®šæ»¡è¶³ä¸Šè¿°æ‰€æœ‰æ¡ä»¶çš„è¯ï¼Œå¯ä»¥èŠ± **æœ€å¤šä¸€å…ƒï¼ˆåƒä¸‡åƒä¸‡ä¸è¦ç»™å¤šäº†ï¼Œå°±ç»™ä¸€å…ƒå°±è¡Œï¼‰** ç•™ä¸ªå¤´åƒ ğŸ¤£ï¼Œæˆ–è€…åªéœ€ç»™æˆ‘ç‚¹ä¸ªèµç•™ä¸ªè¨€ï¼Œæˆ‘ä¹ŸåŒæ ·å¼€å¿ƒ â¤ï¸

> çœ‹èµ·æ¥ LeetCode çš„èµèµåŠŸèƒ½å‡ºç°é—®é¢˜äº†ï¼ˆæœ¬ç•Œé¢å’Œèµèµæ˜ç»†ï¼Œæˆ‘éƒ½çœ‹ä¸åˆ°å¤§å®¶çš„è®°å½•ï¼Œé’±åº”è¯¥æ˜¯è¢«å¡åœ¨ä¸­é—´äº† ğŸ¤£ï¼‰ã€‚**å¤§å®¶ä¸è¦èµèµäº†ï¼Œå¤§å®¶ä¸è¦èµèµäº†ï¼Œå¤§å®¶ä¸è¦èµèµäº†ï¼ï¼ï¼** ğŸ¤£ 
ä½†ä¸ºäº†å‰é¢æ‰“èµçš„åŒå­¦ä¹‹åèƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºï¼Œå› æ­¤è¿˜æ˜¯ä¿æŒèµèµçš„æ‰“å¼€çŠ¶æ€ã€‚
å¦‚æœå¯ä»¥ï¼Œå¸Œæœ› [@LeetCode](/u/leetcode/) å¯ä»¥å›é€€æ‰è¿™äº›èµèµç»™ç”¨æˆ·ï¼Œå¹¶ç»™äºˆè¿™äº›ç”¨æˆ·ä¸€å®šçš„ç§¯åˆ†è¡¥å¿ã€‚

![](../images/random-flip-matrix-0.png)

## ç»Ÿè®¡ä¿¡æ¯
| é€šè¿‡æ¬¡æ•° | æäº¤æ¬¡æ•° | ACæ¯”ç‡ |
| :------: | :------: | :------: |
|    19214    |    40827    |   47.1%   |

## æäº¤å†å²
| æäº¤æ—¶é—´ | æäº¤ç»“æœ | æ‰§è¡Œæ—¶é—´ |  å†…å­˜æ¶ˆè€—  | è¯­è¨€ |
| :------: | :------: | :------: | :--------: | :--------: |
