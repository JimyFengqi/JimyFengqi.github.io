---
title: 1218-æœ€é•¿å®šå·®å­åºåˆ—(Longest Arithmetic Subsequence of Given Difference)
date: 2021-12-03 22:19:09
categories:
  - ä¸­ç­‰
tags:
  - æ•°ç»„
  - å“ˆå¸Œè¡¨
  - åŠ¨æ€è§„åˆ’
---

> åŸæ–‡é“¾æ¥: https://leetcode-cn.com/problems/longest-arithmetic-subsequence-of-given-difference


## è‹±æ–‡åŸæ–‡
<div><p>Given an integer array <code>arr</code> and an integer <code>difference</code>, return the length of the longest subsequence in <code>arr</code> which is an arithmetic sequence such that the difference between adjacent elements in the subsequence equals <code>difference</code>.</p>

<p>A <strong>subsequence</strong> is a sequence that can be derived from <code>arr</code> by deleting some or no elements without changing the order of the remaining elements.</p>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>

<pre>
<strong>Input:</strong> arr = [1,2,3,4], difference = 1
<strong>Output:</strong> 4
<strong>Explanation: </strong>The longest arithmetic subsequence is [1,2,3,4].</pre>

<p><strong>Example 2:</strong></p>

<pre>
<strong>Input:</strong> arr = [1,3,5,7], difference = 1
<strong>Output:</strong> 1
<strong>Explanation: </strong>The longest arithmetic subsequence is any single element.
</pre>

<p><strong>Example 3:</strong></p>

<pre>
<strong>Input:</strong> arr = [1,5,7,8,5,3,4,2,1], difference = -2
<strong>Output:</strong> 4
<strong>Explanation: </strong>The longest arithmetic subsequence is [7,5,3,1].
</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>1 &lt;= arr.length &lt;= 10<sup>5</sup></code></li>
	<li><code>-10<sup>4</sup> &lt;= arr[i], difference &lt;= 10<sup>4</sup></code></li>
</ul>
</div>

## ä¸­æ–‡é¢˜ç›®
<div><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„Â <code>arr</code>Â å’Œä¸€ä¸ªæ•´æ•°Â <code>difference</code>ï¼Œè¯·ä½ æ‰¾å‡ºå¹¶è¿”å› <code>arr</code>Â ä¸­æœ€é•¿ç­‰å·®å­åºåˆ—çš„é•¿åº¦ï¼Œè¯¥å­åºåˆ—ä¸­ç›¸é‚»å…ƒç´ ä¹‹é—´çš„å·®ç­‰äº <code>difference</code> ã€‚</p>

<p><strong>å­åºåˆ—</strong> æ˜¯æŒ‡åœ¨ä¸æ”¹å˜å…¶ä½™å…ƒç´ é¡ºåºçš„æƒ…å†µä¸‹ï¼Œé€šè¿‡åˆ é™¤ä¸€äº›å…ƒç´ æˆ–ä¸åˆ é™¤ä»»ä½•å…ƒç´ è€Œä» <code>arr</code> æ´¾ç”Ÿå‡ºæ¥çš„åºåˆ—ã€‚</p>

<p>Â </p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>arr = [1,2,3,4], difference = 1
<strong>è¾“å‡ºï¼š</strong>4
<strong>è§£é‡Šï¼š</strong>æœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ [1,2,3,4]ã€‚</pre>

<p><strong>ç¤ºä¾‹Â 2ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>arr = [1,3,5,7], difference = 1
<strong>è¾“å‡ºï¼š</strong>1
<strong>è§£é‡Šï¼š</strong>æœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ä»»æ„å•ä¸ªå…ƒç´ ã€‚
</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>

<pre>
<strong>è¾“å…¥ï¼š</strong>arr = [1,5,7,8,5,3,4,2,1], difference = -2
<strong>è¾“å‡ºï¼š</strong>4
<strong>è§£é‡Šï¼š</strong>æœ€é•¿çš„ç­‰å·®å­åºåˆ—æ˜¯ [7,5,3,1]ã€‚
</pre>

<p>Â </p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>1 <= arr.length <= 10<sup>5</sup></code></li>
	<li><code>-10<sup>4</sup> <= arr[i], difference <= 10<sup>4</sup></code></li>
</ul>
</div>

## é€šè¿‡ä»£ç 
<RecoDemo>
</RecoDemo>


## é«˜èµé¢˜è§£
## åºåˆ— DP + å“ˆå¸Œè¡¨

**å®šä¹‰ $f[i][j]$ï¼ˆ$j$ é $0$ å³ $1$ï¼‰ ä¸ºä»£è¡¨è€ƒè™‘å‰ $i$ ä¸ªæ•°ï¼Œä¸”ç¬¬ $i$ ä¸ªæ•°çš„é€‰æ‹©æƒ…å†µä¸º $j$ æ—¶ï¼Œå¾—åˆ°çš„æœ€é•¿å®šå·®å­åºåˆ—é•¿åº¦ã€‚**

æœ€ç»ˆç­”æ¡ˆä¸º $\max(f[n - 1][0], f[n - 1][1])$ï¼ŒåŒæ—¶æˆ‘ä»¬æœ‰æ˜¾ç„¶çš„åˆå§‹åŒ–æ¡ä»¶ $f[0][0] = 0$ å’Œ $f[0][1] = 1$ã€‚

ä¸å¤±ä¸€èˆ¬æ€§è€ƒè™‘ $f[i][j]$ å¦‚ä½•è½¬ç§»ï¼š

* $f[i][0]$ï¼šæ˜ç¡®äº†ç¬¬ $i$ ä¸ªä¸é€‰ï¼Œé‚£ä¹ˆæ­¤æ—¶æœ€å¤§é•¿åº¦ä¸ºå‰ä¸€ä¸ªä½ç½®çš„ç»“æœã€‚å³æœ‰ï¼š

$$
f[i][0] = \max(f[i - 1][0], f[i - 1][1])
$$

* $f[i][1]$ï¼šæ˜ç¡®äº†ç¬¬ $i$ ä¸ªè¦é€‰ï¼Œæ­¤æ—¶è¿›è¡Œåˆ†æƒ…å†µè®¨è®ºï¼š
    
    * $arr[i]$ ç‹¬ç«‹æˆä¸ºä¸€ä¸ªå­åºåˆ—ï¼Œæ­¤æ—¶æœ‰ï¼š$f[i][1] = 1$ï¼›
    * $arr[i]$ æ¥åœ¨æŸä¸€ä¸ªæ•°çš„åé¢ï¼Œç”±äºç»™å®šäº†å·®å€¼ $difference$ï¼Œå¯ç›´æ¥ç®—å¾—ä¸Šä¸€ä½çš„å€¼ä¸º $prev = arr[i] - difference$ï¼Œæ­¤æ—¶åº”å½“æ‰¾åˆ°å€¼ä¸º $prev$ï¼Œä¸‹æ ‡æœ€å¤§ï¼ˆä¸‹æ ‡å°äº $i$ï¼‰çš„ä½ç½®ï¼Œç„¶åä»è¯¥ä½ç½®è½¬ç§»è¿‡æ¥ï¼Œå³æœ‰ï¼š$f[i][1] = f[hash[prev]][1] + 1$;
    
    > å®¹æ˜“è¯æ˜ï¼šå¦‚æœå­˜åœ¨å¤šä¸ªä½ç½®çš„å€¼ä¸º $prev$ï¼Œä»ä¸­é€‰æ‹©ä¸€ä¸ªä¸‹æ ‡æœ€å¤§çš„ä½ç½®ï¼ˆä¸‹æ ‡å°äº $i$ï¼‰è¿›è¡Œè½¬ç§»ï¼Œç»“æœç›¸æ¯”äºæœ€ä¼˜ä½ç½®ä¸ä¼šå˜å·®ã€‚å› æ­¤æˆ‘ä»¬ã€Œè´ªå¿ƒã€é€‰æ‹©ä¸‹æ ‡æœ€å¤§çš„ä½ç½®ï¼ˆä¸‹æ ‡å°äº $i$ï¼‰å³å¯ï¼Œè¿™å¼•å¯¼æˆ‘ä»¬åœ¨è½¬ç§»è¿‡ç¨‹ä¸­ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€è®°å½•å¤„ç†è¿‡çš„ä½ç½®çš„å€¼ä¿¡æ¯ã€‚

    ç»¼ä¸Šï¼Œæˆ‘ä»¬æœ‰ï¼š

$$
f[i][1] = \begin{cases}
1 & hash[arr[i] - difference] = -1 \\
f[hash[prev]][1] + 1 & hash[arr[i] - difference] \neq -1
\end{cases}
$$

![image.png](../images/longest-arithmetic-subsequence-of-given-difference-0.png)

ä»£ç ï¼ˆä½¿ç”¨æ•°ç»„å……å½“å“ˆå¸Œè¡¨çš„ä»£ç åœ¨ $P2$ï¼‰ï¼š
```Java []
class Solution {
    public int longestSubsequence(int[] arr, int d) {
        int n = arr.length;
        Map<Integer, Integer> map = new HashMap<>();
        int[][] f = new int[n][2];
        f[0][1] = 1;
        map.put(arr[0], 0);
        for (int i = 1; i < n; i++) {
            f[i][0] = Math.max(f[i - 1][0], f[i - 1][1]);
            f[i][1] = 1;
            int prev = arr[i] - d;
            if (map.containsKey(prev)) f[i][1] = Math.max(f[i][1], f[map.get(prev)][1] + 1);
            map.put(arr[i], i);
        }
        return Math.max(f[n - 1][0], f[n - 1][1]);
    }
}
```
```Java []
class Solution {
    int N = 40009, M = N / 2;
    public int longestSubsequence(int[] arr, int d) {
        int n = arr.length;
        int[] hash = new int[N];
        Arrays.fill(hash, -1);
        int[][] f = new int[n][2];
        f[0][1] = 1;
        hash[arr[0] + M] = 0;
        for (int i = 1; i < n; i++) {
            f[i][0] = Math.max(f[i - 1][0], f[i - 1][1]);
            f[i][1] = 1;
            int prev = arr[i] - d;
            if (hash[prev + M] != -1) f[i][1] = Math.max(f[i][1], f[hash[prev + M]][1] + 1);
            hash[arr[i] + M] = i;
        }
        return Math.max(f[n - 1][0], f[n - 1][1]);
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸ºæ•°ç»„é•¿åº¦ï¼Œå…±æœ‰ $n * 2$ ä¸ªçŠ¶æ€éœ€è¦è¢«è®¡ç®—ï¼Œæ¯ä¸ªçŠ¶æ€è½¬ç§»çš„å¤æ‚åº¦ä¸º $O(1)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

## ä¼˜åŒ–çŠ¶æ€å®šä¹‰

ä¸éš¾å‘ç°ï¼Œæˆ‘ä»¬å¤šå®šä¹‰ä¸€ç»´çŠ¶æ€æ¥åŒºåˆ†æŸä¸ªä½ç½®çš„å€¼æ˜¯å¦è¢«é€‰æ‹©ï¼Œç›®çš„æ˜¯ä¸ºäº†æ­£ç¡®è½¬ç§»å‡ºç¬¬ $i$ ä½è¢«é€‰æ‹©çš„æƒ…å†µã€‚

äº‹å®ä¸Šï¼Œåˆ©ç”¨å“ˆå¸Œè¡¨æœ¬èº«æˆ‘ä»¬å°±èƒ½è½»æ¾åšåˆ°è¿™ä¸€ç‚¹ã€‚

æˆ‘ä»¬è°ƒæ•´çŠ¶æ€å®šä¹‰ä¸ºï¼š**$f[i]$ ä¸ºè€ƒè™‘å‰ $i$ ä¸ªæ•°ï¼ˆç¬¬ $i$ ä¸ªæ•°å¿…é€‰ï¼‰æ—¶ï¼Œå¾—åˆ°çš„æœ€é•¿å®šå·®å­åºåˆ—é•¿åº¦ã€‚**

ä¸å¤±ä¸€èˆ¬æ€§è€ƒè™‘ $f[i]$ è¯¥å¦‚ä½•è½¬ç§»ï¼Œåˆ†æƒ…å†µè®¨è®ºï¼š

* $arr[i]$ ç‹¬ç«‹æˆä¸ºä¸€ä¸ªå­åºåˆ—ï¼Œæ­¤æ—¶æœ‰ï¼š$f[i] = 1$ï¼›
* $arr[i]$ æ¥åœ¨æŸä¸€ä¸ªæ•°çš„åé¢ï¼Œç”±äºç»™å®šäº†å·®å€¼ $difference$ï¼Œå¯ç›´æ¥ç®—å¾—ä¸Šä¸€ä½çš„å€¼ä¸º $prev = arr[i] - difference$ï¼Œæ­¤æ—¶åº”å½“æ‰¾åˆ° $arr[j]$ ä¸º $prev$ çš„æœ€æ–°ä½ç½®ï¼ˆä¸‹æ ‡æœ€å¤§ï¼ŒåŒæ—¶æ»¡è¶³ $j < i$ï¼‰å½“æ—¶çš„è½¬ç§»ç»“æœï¼Œåœ¨æ­¤åŸºç¡€ä¸ŠåŠ ä¸€å³å¯ï¼Œå³æœ‰ï¼š$f[i] = hash[prev] + 1$;
    
ç»¼ä¸Šï¼Œæˆ‘ä»¬æœ‰ï¼ˆ$hash$ åˆå§‹åŒ–ä¸º $0$ï¼‰ï¼š

$$
f[i] = hash[prev] + 1
$$

![image.png](../images/longest-arithmetic-subsequence-of-given-difference-1.png)

ä»£ç ï¼ˆä½¿ç”¨æ•°ç»„å……å½“å“ˆå¸Œè¡¨çš„ä»£ç åœ¨ $P2$ï¼‰ï¼š
```Java []
class Solution {
    public int longestSubsequence(int[] arr, int d) {
        int ans = 1;
        Map<Integer, Integer> map = new HashMap<>();
        for (int i : arr) {
            map.put(i, map.getOrDefault(i - d, 0) + 1);
            ans = Math.max(ans, map.get(i));
        }
        return ans;
    }
}
```
```Java []
class Solution {
    int N = 40009, M = N / 2;
    public int longestSubsequence(int[] arr, int d) {
        int ans = 1;
        int[] hash = new int[N];
        for (int i : arr) {
            hash[i + M] = hash[i - d + M] + 1;
            ans = Math.max(ans, hash[i + M]);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸ºæ•°ç»„é•¿åº¦ï¼Œå…±æœ‰ $n$ ä¸ªçŠ¶æ€éœ€è¦è¢«è®¡ç®—ï¼Œæ¯ä¸ªçŠ¶æ€è½¬ç§»çš„å¤æ‚åº¦ä¸º $O(1)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$


---

## å…¶ä»–

æ„çŠ¹æœªå°½ï¼Ÿè€ƒè™‘åŠ ç»ƒå¦‚ä¸‹ã€Œåºåˆ— DPã€å†…å®¹ ğŸ­ğŸ­ğŸ­

| é¢˜ç›®                                                         | é¢˜è§£                                                         | éš¾åº¦ | æ¨èæŒ‡æ•° |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- | -------- |
| [354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](https://leetcode-cn.com/problems/russian-doll-envelopes/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/russian-doll-envelopes/solution/zui-chang-shang-sheng-zi-xu-lie-bian-xin-6s8d/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [368. æœ€å¤§æ•´é™¤å­é›†](https://leetcode-cn.com/problems/largest-divisible-subset/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/largest-divisible-subset/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-0a3jc/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [446. ç­‰å·®æ•°åˆ—åˆ’åˆ† II - å­åºåˆ—](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/arithmetic-slices-ii-subsequence/solution/gong-shui-san-xie-xiang-jie-ru-he-fen-xi-ykvk/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [583. ä¸¤ä¸ªå­—ç¬¦ä¸²çš„åˆ é™¤æ“ä½œ](https://leetcode-cn.com/problems/delete-operation-for-two-strings/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/delete-operation-for-two-strings/solution/gong-shui-san-xie-cong-liang-chong-xu-li-wqv7/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [673. æœ€é•¿é€’å¢å­åºåˆ—çš„ä¸ªæ•°](https://leetcode-cn.com/problems/number-of-longest-increasing-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/number-of-longest-increasing-subsequence/solution/gong-shui-san-xie-lis-de-fang-an-shu-wen-obuz/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [740. åˆ é™¤å¹¶è·å¾—ç‚¹æ•°](https://leetcode-cn.com/problems/delete-and-earn/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/delete-and-earn/solution/gong-shui-san-xie-zhuan-huan-wei-xu-lie-6c9t0/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |
| [978. æœ€é•¿æ¹æµå­æ•°ç»„](https://leetcode-cn.com/problems/longest-turbulent-subarray/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-turbulent-subarray/solution/xiang-jie-dong-tai-gui-hua-ru-he-cai-dp-3spgj/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©      |
| [1035. ä¸ç›¸äº¤çš„çº¿](https://leetcode-cn.com/problems/uncrossed-lines/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/uncrossed-lines/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-bkaas/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1143. æœ€é•¿å…¬å…±å­åºåˆ—](https://leetcode-cn.com/problems/longest-common-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/longest-common-subsequence/solution/gong-shui-san-xie-zui-chang-gong-gong-zi-xq0h/) | ä¸­ç­‰ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1473. ç²‰åˆ·æˆ¿å­ III](https://leetcode-cn.com/problems/paint-house-iii/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/paint-house-iii/solution/gong-shui-san-xie-san-wei-dong-tai-gui-h-ud7m/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©     |
| [1713. å¾—åˆ°å­åºåˆ—çš„æœ€å°‘æ“ä½œæ¬¡æ•°](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/) | [LeetCode é¢˜è§£é“¾æ¥](https://leetcode-cn.com/problems/minimum-operations-to-make-a-subsequence/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-oj7yu/) | å›°éš¾ | ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©ğŸ¤©    |

**æ³¨ï¼šä»¥ä¸Šç›®å½•æ•´ç†æ¥è‡ª [wiki](https://github.com/SharingSource/LogicStack-LeetCode/wiki/åºåˆ—-DP)ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½å¼•ç”¨è¯·ä¿ç•™å‡ºå¤„ã€‚**

---

## æœ€å

**å¦‚æœæœ‰å¸®åŠ©åˆ°ä½ ï¼Œè¯·ç»™é¢˜è§£ç‚¹ä¸ªèµå’Œæ”¶è—ï¼Œè®©æ›´å¤šçš„äººçœ‹åˆ° ~ ("â–”â–¡â–”)/**

ä¹Ÿæ¬¢è¿ä½  [å…³æ³¨æˆ‘](https://oscimg.oschina.net/oscnet/up-19688dc1af05cf8bdea43b2a863038ab9e5.png)ï¼ˆå…¬ä¸»å·åå°å›å¤ã€Œé€ä¹¦ã€å³å¯å‚ä¸é•¿æœŸçœ‹é¢˜è§£å­¦ç®—æ³•é€å®ä½“ä¹¦æ´»åŠ¨ï¼‰æˆ– åŠ å…¥[ã€Œç»„é˜Ÿæ‰“å¡ã€](https://leetcode-cn.com/u/ac_oier/)å°ç¾¤ ï¼Œæä¾›å†™ã€Œè¯æ˜ã€&ã€Œæ€è·¯ã€çš„é«˜è´¨é‡é¢˜è§£ã€‚

æ‰€æœ‰é¢˜è§£å·²ç»åŠ å…¥ [åˆ·é¢˜æŒ‡å—](https://github.com/SharingSource/LogicStack-LeetCode/wiki)ï¼Œæ¬¢è¿ star å“¦ ~ 

## ç»Ÿè®¡ä¿¡æ¯
| é€šè¿‡æ¬¡æ•° | æäº¤æ¬¡æ•° | ACæ¯”ç‡ |
| :------: | :------: | :------: |
|    36706    |    71394    |   51.4%   |

## æäº¤å†å²
| æäº¤æ—¶é—´ | æäº¤ç»“æœ | æ‰§è¡Œæ—¶é—´ |  å†…å­˜æ¶ˆè€—  | è¯­è¨€ |
| :------: | :------: | :------: | :--------: | :--------: |
