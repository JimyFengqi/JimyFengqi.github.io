---
title: 1632-çŸ©é˜µè½¬æ¢åçš„ç§©(Rank Transform of a Matrix)
categories:
  - å›°éš¾
tags:
  - è´ªå¿ƒ
  - å¹¶æŸ¥é›†
  - å›¾
  - æ‹“æ‰‘æ’åº
  - æ•°ç»„
  - çŸ©é˜µ
abbrlink: 3245312032
date: 2021-12-03 22:21:45
---

> åŸæ–‡é“¾æ¥: https://leetcode-cn.com/problems/rank-transform-of-a-matrix


## è‹±æ–‡åŸæ–‡
<div><p>Given an <code>m x n</code> <code>matrix</code>, return <em>a new matrix </em><code>answer</code><em> where </em><code>answer[row][col]</code><em> is the </em><em><strong>rank</strong> of </em><code>matrix[row][col]</code>.</p>

<p>The <strong>rank</strong> is an <strong>integer</strong> that represents how large an element is compared to other elements. It is calculated using the following rules:</p>

<ul>
	<li>The rank is an integer starting from <code>1</code>.</li>
	<li>If two elements <code>p</code> and <code>q</code> are in the <strong>same row or column</strong>, then:
	<ul>
		<li>If <code>p &lt; q</code> then <code>rank(p) &lt; rank(q)</code></li>
		<li>If <code>p == q</code> then <code>rank(p) == rank(q)</code></li>
		<li>If <code>p &gt; q</code> then <code>rank(p) &gt; rank(q)</code></li>
	</ul>
	</li>
	<li>The <strong>rank</strong> should be as <strong>small</strong> as possible.</li>
</ul>

<p>It is guaranteed that <code>answer</code> is unique under the given rules.</p>

<p>&nbsp;</p>
<p><strong>Example 1:</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2020/10/18/rank1.jpg" style="width: 442px; height: 162px;" />
<pre>
<strong>Input:</strong> matrix = [[1,2],[3,4]]
<strong>Output:</strong> [[1,2],[2,3]]
<strong>Explanation:</strong>
The rank of matrix[0][0] is 1 because it is the smallest integer in its row and column.
The rank of matrix[0][1] is 2 because matrix[0][1] &gt; matrix[0][0] and matrix[0][0] is rank 1.
The rank of matrix[1][0] is 2 because matrix[1][0] &gt; matrix[0][0] and matrix[0][0] is rank 1.
The rank of matrix[1][1] is 3 because matrix[1][1] &gt; matrix[0][1], matrix[1][1] &gt; matrix[1][0], and both matrix[0][1] and matrix[1][0] are rank 2.
</pre>

<p><strong>Example 2:</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2020/10/18/rank2.jpg" style="width: 442px; height: 162px;" />
<pre>
<strong>Input:</strong> matrix = [[7,7],[7,7]]
<strong>Output:</strong> [[1,1],[1,1]]
</pre>

<p><strong>Example 3:</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2020/10/18/rank3.jpg" style="width: 601px; height: 322px;" />
<pre>
<strong>Input:</strong> matrix = [[20,-21,14],[-19,4,19],[22,-47,24],[-19,4,19]]
<strong>Output:</strong> [[4,2,3],[1,3,4],[5,1,6],[1,3,4]]
</pre>

<p><strong>Example 4:</strong></p>
<img alt="" src="https://assets.leetcode.com/uploads/2020/10/18/rank4.jpg" style="width: 601px; height: 242px;" />
<pre>
<strong>Input:</strong> matrix = [[7,3,6],[1,4,5],[9,8,2]]
<strong>Output:</strong> [[5,1,4],[1,2,3],[6,3,1]]
</pre>

<p>&nbsp;</p>
<p><strong>Constraints:</strong></p>

<ul>
	<li><code>m == matrix.length</code></li>
	<li><code>n == matrix[i].length</code></li>
	<li><code>1 &lt;= m, n &lt;= 500</code></li>
	<li><code>-10<sup>9</sup> &lt;= matrix[row][col] &lt;= 10<sup>9</sup></code></li>
</ul>
</div>

## ä¸­æ–‡é¢˜ç›®
<div><p>ç»™ä½ ä¸€ä¸ªÂ <code>m x n</code>Â çš„çŸ©é˜µ <code>matrix</code>Â ï¼Œè¯·ä½ è¿”å›ä¸€ä¸ªæ–°çš„çŸ©é˜µ<em>Â </em><code>answer</code>Â ï¼Œå…¶ä¸­<em>Â </em><code>answer[row][col]</code>Â æ˜¯Â <code>matrix[row][col]</code>Â çš„ç§©ã€‚</p>

<p>æ¯ä¸ªå…ƒç´ çš„Â <b>ç§©</b>Â æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªå…ƒç´ ç›¸å¯¹äºå…¶ä»–å…ƒç´ çš„å¤§å°å…³ç³»ï¼Œå®ƒæŒ‰ç…§å¦‚ä¸‹è§„åˆ™è®¡ç®—ï¼š</p>

<ul>
	<li>ç§©æ˜¯ä» 1 å¼€å§‹çš„ä¸€ä¸ªæ•´æ•°ã€‚</li>
	<li>å¦‚æœä¸¤ä¸ªå…ƒç´ Â <code>p</code> å’ŒÂ <code>q</code>Â åœ¨ <strong>åŒä¸€è¡Œ</strong>Â æˆ–è€… <strong>åŒä¸€åˆ—</strong>Â ï¼Œé‚£ä¹ˆï¼š
	<ul>
		<li>å¦‚æœÂ <code>p < q</code> ï¼Œé‚£ä¹ˆÂ <code>rank(p) < rank(q)</code></li>
		<li>å¦‚æœÂ <code>p == q</code>Â ï¼Œé‚£ä¹ˆÂ <code>rank(p) == rank(q)</code></li>
		<li>å¦‚æœÂ <code>p > q</code>Â ï¼Œé‚£ä¹ˆÂ <code>rank(p) > rank(q)</code></li>
	</ul>
	</li>
	<li><b>ç§©</b>Â éœ€è¦è¶Š <strong>å°</strong>Â è¶Šå¥½ã€‚</li>
</ul>

<p>é¢˜ç›®ä¿è¯æŒ‰ç…§ä¸Šé¢è§„åˆ™Â <code>answer</code>Â æ•°ç»„æ˜¯å”¯ä¸€çš„ã€‚</p>

<p>Â </p>

<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/10/25/rank1.jpg" style="width: 442px; height: 162px;" />
<pre>
<b>è¾“å…¥ï¼š</b>matrix = [[1,2],[3,4]]
<b>è¾“å‡ºï¼š</b>[[1,2],[2,3]]
<strong>è§£é‡Šï¼š</strong>
matrix[0][0] çš„ç§©ä¸º 1 ï¼Œå› ä¸ºå®ƒæ˜¯æ‰€åœ¨è¡Œå’Œåˆ—çš„æœ€å°æ•´æ•°ã€‚
matrix[0][1] çš„ç§©ä¸º 2 ï¼Œå› ä¸º matrix[0][1] > matrix[0][0] ä¸” matrix[0][0] çš„ç§©ä¸º 1 ã€‚
matrix[1][0] çš„ç§©ä¸º 2 ï¼Œå› ä¸º matrix[1][0] > matrix[0][0] ä¸” matrix[0][0] çš„ç§©ä¸º 1 ã€‚
matrix[1][1] çš„ç§©ä¸º 3 ï¼Œå› ä¸º matrix[1][1] > matrix[0][1]ï¼Œ matrix[1][1] > matrix[1][0] ä¸” matrix[0][1] å’Œ matrix[1][0] çš„ç§©éƒ½ä¸º 2 ã€‚
</pre>

<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/10/25/rank2.jpg" style="width: 442px; height: 162px;" />
<pre>
<b>è¾“å…¥ï¼š</b>matrix = [[7,7],[7,7]]
<b>è¾“å‡ºï¼š</b>[[1,1],[1,1]]
</pre>

<p><strong>ç¤ºä¾‹ 3ï¼š</strong></p>
<img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/10/25/rank3.jpg" style="width: 601px; height: 322px;" />
<pre>
<b>è¾“å…¥ï¼š</b>matrix = [[20,-21,14],[-19,4,19],[22,-47,24],[-19,4,19]]
<b>è¾“å‡ºï¼š</b>[[4,2,3],[1,3,4],[5,1,6],[1,3,4]]
</pre>

<p><strong>ç¤ºä¾‹ 4ï¼š</strong></p>
<img alt="" src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/10/25/rank4.jpg" style="width: 601px; height: 242px;" />
<pre>
<b>è¾“å…¥ï¼š</b>matrix = [[7,3,6],[1,4,5],[9,8,2]]
<b>è¾“å‡ºï¼š</b>[[5,1,4],[1,2,3],[6,3,1]]
</pre>

<p>Â </p>

<p><strong>æç¤ºï¼š</strong></p>

<ul>
	<li><code>m == matrix.length</code></li>
	<li><code>n == matrix[i].length</code></li>
	<li><code>1 <= m, n <= 500</code></li>
	<li><code>-10<sup>9</sup> <= matrix[row][col] <= 10<sup>9</sup></code></li>
</ul>
</div>

## é€šè¿‡ä»£ç 
<RecoDemo>
</RecoDemo>


## é«˜èµé¢˜è§£
### é¢˜ç›®åˆ†æ

é¦–å…ˆï¼Œå°†æ¯è¡ŒåŠæ¯åˆ—ä¸­ç›¸ç­‰çš„å…ƒç´ æ‰¾å‡ºæ¥ï¼Œç„¶åè¿å¹¶æŸ¥é›†çš„è¾¹ï¼Œæ³¨æ„è¿™é‡Œä¸éœ€è¦è¿æ‰€æœ‰è¾¹ï¼Œåªè¦ç›¸é‚»ä¸¤ä¸ªè¿è¾¹å³å¯ã€‚åœ¨åé¢çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªè€ƒè™‘å¹¶æŸ¥é›†ä¸­æ¯ä¸€ä¸ªè¿é€šåˆ†é‡çš„æ ¹èŠ‚ç‚¹ã€‚

æ¥ä¸‹æ¥ï¼Œæ¯è¡Œæ¯åˆ—åˆ†åˆ«æ’åºï¼Œæ ¹æ®æ’åºåçš„å¤§å°å…³ç³»è¿æ‹“æ‰‘æ’åºçš„è¾¹ã€‚åŒæ ·ï¼Œè¿™é‡Œä¹Ÿä¸éœ€è¦è¿æ‰€æœ‰è¾¹ï¼Œåªè¦ç›¸é‚»ä¸¤ä¸ªå¤§å°ä¸ç­‰çš„å…ƒç´ è¿è¾¹å³å¯ã€‚

ç„¶åï¼Œè¿›è¡Œæ‹“æ‰‘æ’åºã€‚æ¯ä¸ªç‚¹çš„ç§©åˆå§‹éƒ½ä¸º$1$ï¼Œåœ¨æ‹“æ‰‘æ’åºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰ä¸€æ¡ $u\to v$ çš„è¾¹ï¼Œåˆ™å°† $v$ çš„ç§©è®¾ç½®ä¸º $\max(rank(v), rank(u)+1)$ã€‚å…¶ä½™æ“ä½œåŒä¸€èˆ¬çš„æ‹“æ‰‘æ’åºã€‚

æœ€åï¼Œå°†çŸ©é˜µä¸­æ¯ä¸ªç‚¹çš„ç§©è®¾ç½®ä¸ºå¹¶æŸ¥é›†ä¸­å…¶æ‰€åœ¨çš„è¿é€šåˆ†é‡çš„æ ¹èŠ‚ç‚¹çš„ç§©å³å¯ã€‚

### å¤æ‚åº¦

- æ—¶é—´å¤æ‚åº¦ $O(NM\log\max(N,M))$ï¼Œç“¶é¢ˆä¸ºæ’åºã€‚

### å‚è€ƒä»£ç ï¼ˆC++ï¼‰

```cpp
class UnionFind {
  int n;
  vector<int> parent, size;

public:
  UnionFind(int n) {
    this->n = n;
    parent = vector<int>(n);
    size = vector<int>(n, 1);
    for (int i = 0; i < n; ++i)
      parent[i] = i;
  }

  int find(int idx) {
    if (parent[idx] == idx)
      return idx;
    return parent[idx] = find(parent[idx]);
  }

  void connect(int a, int b) {
    int fa = find(a), fb = find(b);
    if (fa != fb) {
      if (size[fa] > size[fb]) {
        parent[fb] = fa;
        size[fa] += size[fb];
      } else {
        parent[fa] = fb;
        size[fb] += size[fa];
      }
    }
  }
};

class Solution {
public:
    vector<vector<int>> matrixRankTransform(vector<vector<int>>& matrix) {
        int n = matrix.size(), m = matrix[0].size();
        UnionFind uf(n * m);
        for (int i = 0; i < n; ++i) {
            map<int, vector<int>> mp;
            for (int j = 0; j < m; ++j)
                mp[matrix[i][j]].emplace_back(i * m + j);
            for (auto &[num, vec] : mp) {
                for (int k = 0; k + 1 < vec.size(); ++k)
                    uf.connect(vec[k], vec[k + 1]);
            }
        }
        for (int j = 0; j < m; ++j) {
            map<int, vector<int>> mp;
            for (int i = 0; i < n; ++i)
                mp[matrix[i][j]].emplace_back(i * m + j);
            for (auto &[num, vec] : mp) {
                for (int k = 0; k + 1 < vec.size(); ++k)
                    uf.connect(vec[k], vec[k + 1]);
            }
        }
        vector<vector<int>> adj(n * m);
        vector<int> indegree(n * m);
        for (int i = 0; i < n; ++i) {
            vector<pair<int, int>> v(m);
            for (int j = 0; j < m; ++j)
                v[j] = make_pair(matrix[i][j], j);
            sort(v.begin(), v.end());
            for (int j = 0; j + 1 < m; ++j)
                if (v[j].first != v[j + 1].first) {
                    int uu = uf.find(i * m + v[j].second);
                    int vv = uf.find(i * m + v[j + 1].second);
                    adj[uu].emplace_back(vv);
                    indegree[vv]++;
                }
        }
        for (int j = 0; j < m; ++j) {
            vector<pair<int, int>> v(n);
            for (int i = 0; i < n; ++i)
                v[i] = make_pair(matrix[i][j], i);
            sort(v.begin(), v.end());
            for (int i = 0; i + 1 < n; ++i)
                if (v[i].first != v[i + 1].first) {
                    int uu = uf.find(v[i].second * m + j);
                    int vv = uf.find(v[i + 1].second * m + j);
                    adj[uu].emplace_back(vv);
                    indegree[vv]++;
                }
        }
        vector<int> ans(n * m, 1);
        queue<int> q;
        for (int i = 0; i < n * m; ++i) {
            if (uf.find(i) == i && indegree[i] == 0)
                q.emplace(i);
        }
        while (!q.empty()) {
            int u = q.front();
            q.pop();
            for (int v : adj[u]) {
                ans[v] = max(ans[v], ans[u] + 1);
                indegree[v]--;
                if (indegree[v] == 0)
                    q.emplace(v);
            }
        }
        vector<vector<int>> result(n, vector<int>(m));
        for (int i = 0; i < n; ++i)
            for (int j = 0; j < m; ++j)
                result[i][j] = ans[uf.find(i * m + j)];
        return result;
    }
};
```
æŒç»­æ›´æ–°æ›´å¤šä¼˜è´¨é¢˜è§£ï¼Œæ¬¢è¿ ğŸŒŸ[å…³æ³¨æˆ‘](https://leetcode-cn.com/u/lucifer1004/)

## ç»Ÿè®¡ä¿¡æ¯
| é€šè¿‡æ¬¡æ•° | æäº¤æ¬¡æ•° | ACæ¯”ç‡ |
| :------: | :------: | :------: |
|    1518    |    4723    |   32.1%   |

## æäº¤å†å²
| æäº¤æ—¶é—´ | æäº¤ç»“æœ | æ‰§è¡Œæ—¶é—´ |  å†…å­˜æ¶ˆè€—  | è¯­è¨€ |
| :------: | :------: | :------: | :--------: | :--------: |
